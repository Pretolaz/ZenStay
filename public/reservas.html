<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenStay | Reservas</title>

    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/wizard-reservas.css">
    <link rel="stylesheet" href="assets/css/timeline.css">
    <link rel="stylesheet" href="assets/css/toast.css">
    <link rel="stylesheet" href="theme/dark.css" id="theme-style">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Sidebar din√¢mica -->
    <div id="sidebar"></div>

    <main class="content">
        <header class="header">
            <button class="menu-toggle" id="header-menu-toggle">‚ò∞</button>
            <h1>üóìÔ∏è Reservas</h1>
            <button id="toggle-theme">üåì</button>
        </header>

        <section class="kanban-actions" style="margin-bottom: 20px; text-align: center;">
            <button id="start-reservation-wizard-btn" class="btn">‚ú® Nova Reserva (Assistente)</button>
        </section>

        <!-- Linha do Tempo de Reservas -->
        <section id="reservas-timeline-container" style="margin-bottom: 20px;">
            <h2>Linha do Tempo de Reservas</h2>
            <div id="timeline-view">
                <!-- A linha do tempo ser√° renderizada aqui via JS -->
            </div>
        </section>

        <!-- Tabela de Reservas -->
        <section id="reservas-table-container">
            <h2>Reservas Atuais</h2>
            <table id="reservas-table">
                <thead>
                    <tr>
                        <th>Im√≥vel</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>H√≥spedes</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="reservas-table-body">
                    <!-- Linhas da tabela ser√£o inseridas aqui via JS -->
                </tbody>
            </table>
        </section>

        <!-- Wizard de Cria√ß√£o de Reserva (Modal Container) -->
        <div id="reservation-wizard-modal" class="wizard-modal-overlay" style="display: none;">
            <div class="wizard-container">
                <!-- Painel Esquerdo: Resumo -->
                <aside class="wizard-summary-panel">
                    <div class="summary-header">
                        <h3>Resumo da Reserva</h3>
                        <p>Acompanhe os detalhes</p>
                    </div>
                    <div class="summary-content" id="wizard-summary-content">
                        <div class="summary-group">
                            <label>Plataforma</label>
                            <div id="summary-plataforma" class="summary-value">- Selecione -</div>
                        </div>

                        <div class="summary-group">
                            <label>Im√≥vel Selecionado</label>
                            <div id="summary-imovel" class="summary-value">- Selecione -</div>
                        </div>

                        <div class="summary-group">
                            <label>H√≥spedes</label>
                            <ul id="summary-hospedes" class="summary-list">
                                <li>- Selecione -</li>
                            </ul>
                        </div>

                        <div class="summary-group">
                            <label>Pets</label>
                            <div id="summary-pets" class="summary-value">N√£o</div>
                        </div>

                        <div class="summary-group">
                            <label>Per√≠odo</label>
                            <div id="summary-periodo" class="summary-value">- Defina as datas -</div>
                        </div>
                    </div>
                    <div class="summary-footer">
                        <div class="summary-stat">
                            <span>Di√°rias</span>
                            <strong id="summary-diarias">0</strong>
                        </div>
                        <div class="summary-stat">
                            <span>Total</span>
                            <strong id="summary-total-valor">R$ 0,00</strong>
                        </div>
                    </div>
                </aside>

                <!-- Painel Direito: Conte√∫do e Passos -->
                <main class="wizard-main-content">
                    <header class="wizard-header">
                        <div class="step-indicator">
                            <div class="step-item active" data-step="1">
                                <span class="step-number">1</span>
                                <span class="step-label">Plataforma</span>
                            </div>
                            <div class="step-item" data-step="2">
                                <span class="step-number">2</span>
                                <span class="step-label">Im√≥vel</span>
                            </div>
                            <div class="step-item" data-step="3">
                                <span class="step-number">3</span>
                                <span class="step-label">Detalhes</span>
                            </div>
                            <div class="step-item" data-step="4">
                                <span class="step-number">4</span>
                                <span class="step-label">Pets</span>
                            </div>
                            <div class="step-item" data-step="5">
                                <span class="step-number">5</span>
                                <span class="step-label">Valores</span>
                            </div>
                        </div>
                        <button class="close-wizard-btn" id="close-wizard-btn">&times;</button>
                    </header>

                    <div class="wizard-body">
                        <!-- Passo 1: Plataforma -->
                        <div id="step-1" class="wizard-step">
                            <h2 class="step-title">Escolha a Plataforma</h2>
                            <p class="step-subtitle">Por onde a reserva foi feita?</p>
                            <div class="property-grid" id="wizard-platform-list">
                                <!-- Lista de Plataformas via JS -->
                            </div>
                        </div>

                        <!-- Passo 2: Im√≥vel -->
                        <div id="step-2" class="wizard-step" style="display: none;">
                            <h2 class="step-title">Selecione o Im√≥vel</h2>
                            <p class="step-subtitle">Qual im√≥vel foi reservado?</p>
                            <div class="property-grid" id="wizard-property-list">
                                <!-- Lista de Im√≥veis via JS -->
                            </div>
                        </div>

                        <!-- Passo 3: H√≥spedes e Datas -->
                        <div id="step-3" class="wizard-step" style="display: none;">
                            <h2 class="step-title">Detalhes da Reserva</h2>
                            <p class="step-subtitle">Quem vem e quando?</p>

                            <div class="form-section">
                                <h3>üë§ H√≥spedes</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <input type="text" id="wizard-hospede-search-input" class="modern-input"
                                            placeholder="Buscar h√≥spede por nome...">
                                    </div>
                                </div>
                                <div id="wizard-hospedes-list" class="guest-list-container">
                                    <!-- Lista de H√≥spedes via JS -->
                                </div>
                            </div>

                            <div class="form-section">
                                <h3>üìÖ Per√≠odo</h3>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Check-in</label>
                                        <input type="date" id="checkin-date" class="modern-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Check-out</label>
                                        <input type="date" id="checkout-date" class="modern-input">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Passo 4: Pets -->
                        <div id="step-4" class="wizard-step" style="display: none;">
                            <h2 class="step-title">Pets</h2>
                            <p class="step-subtitle">Haver√° animais de estima√ß√£o?</p>

                            <div class="pet-slider-wrapper"
                                style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <h4 style="margin: 0; font-size: 1.1rem;">Trazer Pets?</h4>
                                    <p style="margin: 5px 0 0; color: #666; font-size: 0.9rem;">Ative se a reserva
                                        incluir animais.</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="has-pets-toggle">
                                    <span class="slider round"></span>
                                </label>
                            </div>

                            <div id="pet-warning-container"
                                style="display: none; margin-top: 20px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; border-radius: 8px;">
                                ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> O im√≥vel selecionado n√£o aceita pets.
                            </div>
                        </div>

                        <!-- Passo 5: Valores -->
                        <div id="step-5" class="wizard-step" style="display: none;">
                            <h2 class="step-title">Valores da Reserva</h2>
                            <p class="step-subtitle">Confira e ajuste os valores.</p>

                            <div class="form-section">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Valor da Di√°ria (R$)</label>
                                        <input type="number" id="valor-diaria" class="modern-input" step="0.01" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Total de Di√°rias</label>
                                        <input type="text" id="total-dias-display" class="modern-input" readonly
                                            disabled>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Taxa de Limpeza (R$)</label>
                                        <input type="number" id="taxa-limpeza" class="modern-input" step="0.01" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Taxas Extras (R$)</label>
                                        <input type="number" id="taxas-extras" class="modern-input" step="0.01" min="0">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Desconto (R$)</label>
                                        <input type="number" id="valor-desconto" class="modern-input" step="0.01"
                                            min="0">
                                    </div>
                                    <div class="form-group">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <footer class="wizard-footer">
                        <button class="btn btn-ghost" id="wizard-prev-btn" style="display: none;">Voltar</button>
                        <button class="btn" id="wizard-next-btn">Continuar</button>
                    </footer>
                </main>
            </div>
        </div>

        <!-- Modal de Detalhes da Reserva (Zoom) -->
        <div id="reservation-details-modal" class="details-modal-overlay" style="display: none;">
            <div class="details-card">
                <button class="close-details-btn" id="close-details-btn">&times;</button>
                <div class="details-card-header">
                    <div class="details-imovel-thumb">
                        <img id="details-imovel-foto" src="" alt="Foto do Im√≥vel">
                    </div>
                    <div class="details-header-info">
                        <h2 id="details-imovel-titulo">T√≠tulo do Im√≥vel</h2>
                        <span class="status-badge" id="details-status">Confirmada</span>
                    </div>
                </div>
                <div class="details-card-body">
                    <div class="details-row">
                        <div class="details-group">
                            <label>Plataforma</label>
                            <div id="details-plataforma"
                                style="display: flex; align-items: center; gap: 8px; font-weight: 500;">
                                <!-- Preenchido via JS -->
                            </div>
                        </div>
                        <div class="details-group">
                            <label>H√≥spedes</label>
                            <p id="details-hospedes">Nome (mais 0)</p>
                        </div>
                    </div>
                    <div class="details-row">
                        <div class="details-group">
                            <label>Check-in</label>
                            <p id="details-checkin">00/00/0000</p>
                            <div class="details-row">
                                <div class="details-group">
                                    <label>Check-in</label>
                                    <p id="details-checkin">00/00/0000</p>
                                </div>
                                <div class="details-group">
                                    <label>Check-out</label>
                                    <p id="details-checkout">00/00/0000</p>
                                </div>
                            </div>
                            <div class="details-row">
                                <div class="details-group">
                                    <label>Pets</label>
                                    <p id="details-pets">0</p>
                                </div>
                                <div class="details-group">
                                    <label>Di√°rias</label>
                                    <p id="details-diarias">0</p>
                                    <!-- Scripts -->
                                    <script
                                        src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
                                        integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
                                        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                                    <script src="assets/js/storage.js"></script>
                                    <script src="assets/js/main.js"></script>

                                    <!-- M√≥dulos que usam 'import' e exp√µem classes para o escopo global -->
                                    <script type="module" src="assets/js/firebase-config.js"></script>
                                    <script type="module" src="assets/js/entities/cliente.js"></script>
                                    <script type="module" src="assets/js/entities/imovel.js?v=2"></script>
                                    <script type="module" src="assets/js/entities/reserva.js"></script>
                                    <script type="module" src="assets/js/entities/plataforma.js"></script>

                                    <!-- Scripts que n√£o s√£o m√≥dulos e dependem das classes acima -->
                                    <script src="assets/js/toast.js"></script>
                                    <script src="assets/js/entities/comodo.js"></script>
                                    <script type="module" src="assets/js/wizard-reservas.js"></script>
                                    <script type="module" src="assets/js/timeline.js"></script>
                                    <script src="assets/js/entities/anfitriao.js"></script>

                                    <!-- Sidebar din√¢mica -->
                                    <script>
                                        const body = document.body;

                                        const setActiveSidebarLink = () => {
                                            const path = window.location.pathname.split("/").pop();
                                            const hash = window.location.hash;

                                            document.querySelectorAll(".sidebar a").forEach(link => {
                                                link.classList.remove("active");
                                                const linkHref = link.getAttribute("href");

                                                if (linkHref === path + hash) {
                                                    link.classList.add("active");
                                                    const parentSubmenu = link.closest('.has-submenu');
                                                    if (parentSubmenu) {
                                                        const submenuElement = parentSubmenu.querySelector('.submenu');
                                                        const arrowElement = parentSubmenu.querySelector('.arrow');
                                                        if (submenuElement) submenuElement.style.display = 'block';
                                                        if (arrowElement) arrowElement.textContent = '‚ñº';
                                                        const submenuToggleElement = parentSubmenu.querySelector('.submenu-toggle');
                                                        if (submenuToggleElement) submenuToggleElement.classList.add('active');
                                                    }
                                                }
                                            });
                                        };

                                        fetch("assets/components/sidebar.html")
                                            .then(res => res.text())
                                            .then(html => {
                                                document.getElementById("sidebar").innerHTML = html;

                                                const sidebarElement = document.querySelector('.sidebar');
                                                const menuToggleButton = document.getElementById('menu-toggle');
                                                const headerMenuToggleButton = document.getElementById('header-menu-toggle');

                                                function toggleSidebar() {
                                                    body.classList.toggle('sidebar-open-mobile');
                                                }

                                                if (menuToggleButton) {
                                                    menuToggleButton.addEventListener('click', function (e) {
                                                        e.stopPropagation();
                                                        toggleSidebar();
                                                    });
                                                }

                                                if (headerMenuToggleButton) {
                                                    headerMenuToggleButton.addEventListener('click', function (e) {
                                                        e.stopPropagation();
                                                        toggleSidebar();
                                                    });
                                                }

                                                document.addEventListener('click', function (e) {
                                                    if (body.classList.contains('sidebar-open-mobile') &&
                                                        sidebarElement && !sidebarElement.contains(e.target) &&
                                                        (menuToggleButton && !menuToggleButton.contains(e.target)) &&
                                                        (headerMenuToggleButton && !headerMenuToggleButton.contains(e.target))) {
                                                        toggleSidebar();
                                                    }
                                                });

                                                document.querySelectorAll('.sidebar a').forEach(link => {
                                                    link.addEventListener('click', function () {
                                                        if (window.innerWidth <= 768 && !this.classList.contains('submenu-toggle')) {
                                                            body.classList.remove('sidebar-open-mobile');
                                                        }
                                                    });
                                                });

                                                document.querySelectorAll('.submenu-toggle').forEach(item => {
                                                    item.addEventListener('click', function (e) {
                                                        e.preventDefault();
                                                        const parentLi = this.closest('.has-submenu');
                                                        parentLi.classList.toggle('expanded');
                                                        const submenu = parentLi.querySelector('.submenu');
                                                        if (submenu) {
                                                            submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
                                                        }
                                                    });
                                                });

                                                setActiveSidebarLink();
                                            })
                                            .catch(err => console.error("Erro ao carregar sidebar: ", err));

                                        window.addEventListener('resize', () => {
                                            if (window.innerWidth > 768 && body.classList.contains('sidebar-open-mobile')) {
                                                body.classList.remove('sidebar-open-mobile');
                                            }
                                        });
                                    </script>
</body>

</html>